<template>
  <div class="page-wrapper">
    <!-- D√©coration de fond v√©g√©tale -->
    <div class="nature-bg">
      <div class="leaf leaf-1">üçÉ</div>
      <div class="leaf leaf-2">üåø</div>
      <div class="leaf leaf-3">üçÇ</div>
      <div class="leaf leaf-4">üå±</div>
      <div class="leaf leaf-5">üçÉ</div>
      <div class="leaf leaf-6">üåø</div>
    </div>

    <div class="page-container">
      
      <!-- HEADER -->
      <header class="page-header">
        <h1>üõ°Ô∏è Protection des Donn√©es (RGPD)</h1>
        <p class="subtitle">Comprendre et appliquer le r√®glement europ√©en sur la protection des donn√©es</p>
      </header>

      <!-- INTRODUCTION -->
      <section class="page-section">
        <div class="content-card">
        <p>Le R√®glement G√©n√©ral sur la Protection des Donn√©es (RGPD) est une r√©glementation de l'Union Europ√©enne entr√©e en vigueur le <strong>25 mai 2018</strong>. Il constitue un cadre juridique visant √† prot√©ger les citoyens europ√©ens contre l'exploitation abusive de leurs donn√©es personnelles.</p>
        </div>
      </section>

      <!-- C'EST QUOI ? -->
      <section class="page-section">
        <h2>üßê Qu'est-ce que le RGPD ?</h2>
        <div class="content-card">
          <p>Le RGPD est un texte de loi √©tablissant que <strong>les donn√©es personnelles appartiennent aux individus</strong>. Aucune organisation ne peut les collecter, les exploiter ou les transmettre sans consentement explicite et √©clair√©.</p>
          <p>Dans un √©tablissement scolaire, le RGPD prot√®ge particuli√®rement les donn√©es sensibles : informations sur les mineurs, r√©sultats scolaires, coordonn√©es personnelles et parcours √©ducatifs.</p>
        </div>
      </section>

      <!-- POURQUOI ? -->
      <section>
        <h2>‚ö†Ô∏è Pourquoi cette protection est-elle n√©cessaire ?</h2>
        <div class="card">
          <p><strong>Les risques du profilage :</strong> L'utilisation d'outils num√©riques gratuits fournis par de grandes entreprises technologiques peut entra√Æner la collecte syst√©matique de donn√©es permettant l'√©tablissement de profils comportementaux d√©taill√©s des utilisateurs (centres d'int√©r√™t, difficult√©s, opinions).</p>
          <hr class="divider">
          <p><strong>Le CLOUD Act :</strong> De nombreuses grandes entreprises technologiques (Microsoft, Google) sont soumises au droit am√©ricain. Le CLOUD Act autorise les autorit√©s am√©ricaines √† acc√©der aux donn√©es stock√©es par ces entreprises, y compris celles h√©berg√©es en Europe. Le RGPD associ√© √† un h√©bergement local permet de limiter cette exposition.</p>
        </div>
      </section>

      <!-- LES 5 PILIERS -->
      <section>
        <h2>üñêÔ∏è Les 5 Principes Fondamentaux</h2>
        <div class="card">
          <ul> 
            <li><strong>La Finalit√© :</strong> Les donn√©es ne peuvent √™tre collect√©es que pour des objectifs pr√©cis et l√©gitimes.</li>
            <li><strong>La Minimisation :</strong> Seules les donn√©es strictement n√©cessaires peuvent √™tre collect√©es.</li>
            <li><strong>La Dur√©e de Conservation :</strong> Les donn√©es doivent √™tre supprim√©es apr√®s une p√©riode d√©finie.</li>
            <li><strong>La S√©curit√© :</strong> Des mesures techniques appropri√©es (chiffrement, contr√¥le d'acc√®s) doivent prot√©ger les donn√©es.</li>
            <li><strong>Les Droits des Personnes :</strong> Chacun dispose du droit d'acc√®s, de rectification et de suppression de ses donn√©es personnelles.</li>
          </ul>
        </div>
      </section>

      <!-- TABLEAU COMPARATIF -->
      <section>
        <h2>‚úÖ Bonnes Pratiques et Alternatives</h2>
        <div class="card no-padding">
          <table>
            <thead>
              <tr>
                <th>‚ùå Pratiques Non Conformes</th>
                <th>‚úÖ Alternatives Conformes au RGPD</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Groupe WhatsApp / Facebook</td>
                <td>Signal ou Messagerie ENT</td>
              </tr>
              <tr>
                <td>Google Drive / Dropbox</td>
                <td>Nextcloud / Serveur du Lyc√©e</td>
              </tr>
              <tr>
                <td>WeTransfer</td>
                <td>FileSender (√âducation Nationale)</td>
              </tr>
              <tr>
                <td>Photos sans floutage</td>
                <td>Autorisation ou Floutage (Droit √† l'image)</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- ========================================= -->
      <!-- PARTIE 2 : LE QUIZ INTERACTIF (JEU)       -->
      <!-- ========================================= -->

      <div class="quiz-wrapper">
        <div class="quiz-container">
          <h2>üìã Quiz : √âvaluation des Connaissances RGPD</h2>
          
          <!-- √âCRAN DE FIN -->
          <div v-if="quizFinished">
            <p class="mission-status">Quiz Termin√©</p>
            <div class="score-box">{{ score }} / {{ questions.length }}</div>
            <p v-if="score === questions.length">üåü Excellent ! Vous ma√Ætrisez les principes du RGPD.</p>
            <p v-else>‚ö†Ô∏è Certaines notions n√©cessitent une r√©vision. Nous vous recommandons de relire le contenu.</p>

            <div class="continue-choices">
              <p class="choices-label">Que veux-tu faire maintenant ?</p>
              <div class="choices-grid">
                <button class="choice-button" @click="continueTo('stockage-hors-ue')">
                  <span class="choice-icon">üîí</span>
                  <span class="choice-title">Continuer : Stockage des donn√©es hors UE</span>
                  <span class="choice-desc">Revoir ou approfondir le stockage hors UE</span>
                </button>
              </div>

              <div style="margin-top:1rem; display:flex; gap:0.75rem; justify-content:center;">
                <button class="btn-primary" @click="continueTo('presentation')">Retour au d√©but üå≥</button>
                <button class="btn-primary" @click="restartQuiz">Recommencer la mission</button>
              </div>
            </div>
          </div>

          <!-- QUESTIONNAIRE -->
          <div v-else>
            <p class="question-count">Question {{ currentQuestion + 1 }} / {{ questions.length }}</p>
            <h3 class="question-text">{{ questions[currentQuestion].text }}</h3>

            <div v-for="(option, index) in questions[currentQuestion].options" :key="index">
              <button 
                class="btn-option" 
                :class="{ 
                    'correct': hasAnswered && option.isCorrect, 
                    'wrong': hasAnswered && !option.isCorrect && selectedAnswer === index 
                }"
                :disabled="hasAnswered"
                @click="selectAnswer(index, option.isCorrect)"
              >
                {{ option.text }}
              </button>
            </div>

            <p v-if="hasAnswered && isCurrentCorrect" class="feedback success">‚úÖ Correct ! {{ questions[currentQuestion].explanation }}</p>
            <p v-if="hasAnswered && !isCurrentCorrect" class="feedback error">‚ùå Erreur ! {{ questions[currentQuestion].explanation }}</p>

            <button v-if="hasAnswered" class="btn-primary" @click="nextQuestion">
              {{ currentQuestion < questions.length - 1 ? 'Question Suivante' : 'Voir le r√©sultat' }}
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>
</template>

<script>
import { unlockPage, navigateToPage } from '../../../router/progress.js'

export default {
  name: 'PageRGPD',
  mounted() {
    // D√©bloquer cette page
    unlockPage('confidentialite')
    // S'assurer d'√™tre en haut de la page lorsque la route est charg√©e
    try {
      window.scrollTo({ top: 0, left: 0, behavior: 'auto' })
    } catch (e) {}
  },
  data() {
    return {
      // --- DONN√âES DU QUIZ ---
      currentQuestion: 0,
      score: 0,
      hasAnswered: false,
      selectedAnswer: null,
      isCurrentCorrect: false,
      quizFinished: false,
      questions: [
        {
          text: "Quelle loi prot√®ge les donn√©es des europ√©ens contre les GAFAM ?",
          explanation: "C'est le R√®glement G√©n√©ral sur la Protection des Donn√©es, actif depuis 2018.",
          options: [
            { text: "Le CLOUD Act", isCorrect: false },
            { text: "Le RGPD", isCorrect: true },
            { text: "La Loi de Murphy", isCorrect: false }
          ]
        },
        {
          text: "Votre prof veut envoyer un fichier de 2Go. Quel outil est conforme ?",
          explanation: "FileSender est l'outil s√©curis√© de l'√âducation Nationale. WeTransfer revend des donn√©es.",
          options: [
            { text: "WeTransfer", isCorrect: false },
            { text: "FileSender", isCorrect: true },
            { text: "Par mail en pi√®ce jointe", isCorrect: false }
          ]
        },
        {
          text: "Pourquoi le 'Cloud Act' am√©ricain est-il un probl√®me pour l'√©cole ?",
          explanation: "Il permet aux espions US de lire les donn√©es stock√©es chez Microsoft ou Google.",
          options: [
            { text: "Il permet aux USA d'acc√©der √† nos donn√©es", isCorrect: true },
            { text: "Il fait pleuvoir sur les serveurs", isCorrect: false },
            { text: "Il rend les ordinateurs plus lents", isCorrect: false }
          ]
        },
        {
          text: "Quelle est la r√®gle de la 'Minimisation' ?",
          explanation: "On ne collecte que ce qui est strictement utile pour la mission.",
          options: [
            { text: "Rendre les fichiers tout petits", isCorrect: false },
            { text: "Ne collecter que les donn√©es strictement n√©cessaires", isCorrect: true },
            { text: "Parler le moins possible", isCorrect: false }
          ]
        }
      ]
    }
  },
  methods: {
    selectAnswer(index, isCorrect) {
      this.hasAnswered = true;
      this.selectedAnswer = index;
      this.isCurrentCorrect = isCorrect;
      if (isCorrect) {
        this.score++;
      }
    },
    nextQuestion() {
      if (this.currentQuestion < this.questions.length - 1) {
        this.currentQuestion++;
        this.hasAnswered = false;
        this.selectedAnswer = null;
      } else {
        // Quiz fini : marquer la page comme compl√©t√©e
        try {
          completePage('confidentialite')
        } catch (e) {
          // ignore if store not available
        }
        this.quizFinished = true;
      }
    },
    restartQuiz() {
      this.currentQuestion = 0;
      this.score = 0;
      this.hasAnswered = false;
      this.selectedAnswer = null;
      this.quizFinished = false;
    }
    ,
    continueTo(pageId) {
      // Utiliser la m√©thode centralis√©e de navigation
      navigateToPage('confidentialite', pageId, this.$router)
    }
  }
}
</script>

<style scoped>
/* Styles sp√©cifiques suppl√©mentaires si n√©cessaire */
.content-card.no-padding {
  padding: 0;
}
</style>